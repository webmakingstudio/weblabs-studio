name: 🚀 Deploy to Production

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: 🚀 Checkout code
      uses: actions/checkout@v4
      
    - name: 📦 Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: 📥 Install dependencies
      run: npm ci
      
    - name: 🔨 Build application
      run: npm run build
      
    - name: 🧪 Run tests (if any)
      run: npm test --if-present
      
    - name: 🚀 Deploy to Vercel
      uses: amondnet/vercel-action@v25
      with:
        vercel-token: ${{ secrets.VERCEL_TOKEN }}
        vercel-org-id: ${{ secrets.ORG_ID }}
        vercel-project-id: ${{ secrets.PROJECT_ID }}
        vercel-args: '--prod'
        
    - name: ✅ Deployment completed
      run: |
        echo "🎉 ¡Deployment a PRODUCCIÓN completado!"
        echo "🌐 Aplicación disponible en: ${{ steps.deploy.outputs.preview-url }}"
        echo "📧 Sistema de emails configurado y funcionando"
        
    - name: 📋 Post-deployment checklist
      run: |
        echo ""
        echo "📋 CHECKLIST POST-DEPLOYMENT:"
        echo "1. ✅ Verificar variables de entorno en Vercel Dashboard"
        echo "2. 🧪 Testear formulario en dominio real"
        echo "3. 📧 Verificar recepción de emails"
        echo "4. 📊 Monitorear logs en Vercel Dashboard"
        echo "5. 🔍 Verificar funcionamiento en producción"
        echo ""
        echo "🎯 ¡Sistema listo para producción!"
